os:
  - linux
sudo: required
services:
  - docker
before_install:
  - sudo service docker restart ; sleep 10
  - jdk_switcher use oraclejdk8
install:
  # - docker pull mysql
  # - docker pull postgres
  - docker pull mongo
  # - docker pull cassandra
  - git clone https://github.com/jhipster/jhipster-sample-app.git
  - git clone https://github.com/jhipster/jhipster-sample-app-mongodb.git
script:
  #------------------
  #--- sample-app ---
  #------------------
  - cd $TRAVIS_BUILD_DIR/jhipster-sample-app/
  - mvn spring-boot:run &
  - sleep 120
  - curl --retry 10 --retry-delay 5 -I http://localhost:8080/ | grep "HTTP/1.1 200 OK"
  - fuser -k 8080/tcp
  - sleep 10
  #--------------------------
  #--- sample-app-mongodb ---
  #--------------------------
  - cd $TRAVIS_BUILD_DIR/jhipster-sample-app-mongodb/
  - docker run -d -p 27017:27017 mongo
  - sleep 10
  - mvn spring-boot:run &
  - sleep 60
  - curl --retry 10 --retry-delay 5 -I http://localhost:8080/ | grep "HTTP/1.1 200 OK"
  - fuser -k 8080/tcp
  - sleep 10
